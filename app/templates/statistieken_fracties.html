{% extends "base.html" %}
{% block content %}

<!-- HERO -->
<section class="hero">
  <h1 class="hero-title">Statistieken per Fractie</h1>
  <p class="hero-subtitle">
    Bekijk hoeveel vragen een fractie stelde over een bepaald thema, in verhouding tot hun totale activiteit Ã©n tot het totale aantal vragen binnen dat thema.
  </p>
</section>

<!-- SELECTIESECTIE -->
<section class="table-section">
  <div class="table-container" style="text-align:center;">

    <!-- Filters -->
    <div class="filters-form" style="justify-content:center;">
      <div class="filter-field">
        <label for="fractieSelect">Kies een fractie</label>
        <select id="fractieSelect">
          <option value="">-- Selecteer fractie --</option>
          {% for f in fracties %}
            <option value="{{ f.id }}">{{ f.naam }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="filter-field">
        <label for="themaSelect">Kies een thema</label>
        <select id="themaSelect">
          <option value="">-- Selecteer thema --</option>
          {% for t in themas %}
            <option value="{{ t.id }}">{{ t.naam }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="filter-field filter-field-button">
        <button id="toonBtn" class="btn">Toon statistieken</button>
      </div>
    </div>

    <!-- Resultaat -->
    <div id="resultaat" style="max-width:700px; margin:2rem auto; text-align:left;"></div>

  </div>
</section>

<!-- SCRIPT -->
<script>
document.getElementById("toonBtn").addEventListener("click", async () => {
  const fractieId = document.getElementById("fractieSelect").value;
  const themaId = document.getElementById("themaSelect").value;

  if (!fractieId || !themaId) {
    alert("Selecteer zowel een fractie als een thema.");
    return;
  }

  const resp = await fetch(`/statistieken/fractie/data/${fractieId}/${themaId}`);
  const data = await resp.json();

  document.getElementById("resultaat").innerHTML = `
    <div class="result-card">
      <h3 class="section-title" style="font-size:1.3rem; margin-bottom:1rem;">Resultaten</h3>
      <div style="display:flex; flex-wrap:wrap; gap:1.5rem;">
        
        <div class="result-block" style="flex:1; min-width:280px;">
          <h4>Deze fractie</h4>
          <p><strong>Aantal vragen over dit thema:</strong> ${data.thema_vragen_fractie}</p>
          <p><strong>% van totale vragen fractie:</strong> ${data.perc_van_fractie}%</p>
        </div>

        <div class="result-block" style="flex:1; min-width:280px;">
          <h4>Alle fracties</h4>
          <p><strong>Totaal aantal vragen in dit thema:</strong> ${data.totaal_vragen_thema}</p>
          <p><strong>% van alle themavragen:</strong> ${data.perc_van_thema}%</p>
        </div>

      </div>
    </div>
  `;
});
</script>

{% endblock %}
